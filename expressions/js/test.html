<html>
	<head>
		<title>Expression testing</title>
		<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="excellent.js"></script>
		<script type="text/javascript">
			$(function () {
				$('#message').on('change keyup paste', function() {
					var text = $(this).val();
					var parser = new excellent.Parser('@', ['channel', 'contact', 'date', 'extra', 'flow', 'step']);
					
					var expressions = parser.findExpressions(text);
					
					var tbody = $('#output').find('tbody');
					tbody.empty()

					for (var e = 0; e < expressions.length; e++) {
						var expression = expressions[e];
						var complete = expression.complete ? "true" : "false"
						var output = '<tr><td>' + expression.start + '</td><td>' + expression.end + '</td><td>' + expression.text + '</td><td>' + complete + '</td></tr>';
						tbody.append(output);
					}
					
				});

				$('#message').trigger('change');
			});
		</script>
		<style type="text/css">
			* { font-family: Arial, Helvetica, sans-serif }
			#message { width: 100%; height: 200px; }
			#output { background-color: #CCC; width: 100% }
			#output th { text-align: left; }
		</style>
	</head>
	<body>
		<textarea id="message">Expressions: 
* @contact.name
* @(ABS(contact.age) + 1)
* @(LEN("@)"))

Not expressions:
* @@flow.response_1.text (escaped)
* @nyaruka or code@nyaruka.com (disallowed top-levels)

Incomplete expression:
* @(UPPER(</textarea>
		<table id="output">
			<thead>
				<tr>
					<th>Start</th>
					<th>End</th>
					<th>Text</th>
					<th>Complete</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</body>
</html>