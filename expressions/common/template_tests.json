[
  {
    "template": "Hi Bob. Nice tests!",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hi Bob. Nice tests!",
    "errors": []
  },
  {
    "template": "Twitter handle for Joe @ Nyaruka is @@flow. @@@flow",
    "context": {"vars": { "flow": "x" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Twitter handle for Joe @ Nyaruka is @flow. @x",
    "errors": []
  },

  /* literals */

  {
    "template": "@(TRUE) @( FALSE ) @(2) @(2.30) @(\"A\"\"a\")",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "TRUE FALSE 2 2.3 A\"a",
    "errors": []
  },

  /* variables */

  {
    "template": "Hi @CONTACT",
    "context": {"vars": {"contact": {"*": "Bob", "name": "Bob"}}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hi Bob",
    "errors": []
  },
  {
    "template": "Hi @contact.name",
    "context": {"vars": {"contact": {"*": "Bob", "name": "Bob"}}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hi Bob",
    "errors": []
  },
  {
    "template": "Hi @(contact.name)",
    "context": {"vars": {"contact": {"*": "Bob", "name": "Bob"}}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hi Bob",
    "errors": []
  },
  {
    "template": "Hi @flow.response_1.text",
    "context": {"vars": {"flow": {"response_1": {"text": "Jim"}}}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hi Jim",
    "errors": []
  },
  {
    "template": "@(X + Y + Z)",
    "context": {"vars": {"x": 1.23, "y": 2, "z": "3"}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "6.23",
    "errors": []
  },
  { /* null values should be handled as empty strings */
    "template": "Name: @foo",
    "context": {"vars": {"foo": null}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Name: ",
    "errors": []
  },

  /* decimal arithmetic */

  {
    "template": "Answer is @(4 + 3 - 1 + -2 + 3 * 2)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Answer is 10",
    "errors": []
  },
  {
    "template": "@(100 / 3) @(2 * 100 / 3)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "33.33333333 66.66666667",
    "errors": []
  },

  /* date arithmetic */

  { /* date var +/- integer */
    "template": "@(dob + 1) @(dob - 3)",
    "context": {"vars": { "dob": "01-12-2014" }, "tz": "Africa/Kigali", "day_first": true},
    "url_encode": false,
    "output": "02-12-2014 28-11-2014",
    "errors": []
  },
  { /* datetime var +/- integer */
    "template": "@(joined + 1) @(joined - 3)",
    "context": {"vars": { "joined": "01-12-2014 09:00" }, "tz": "Africa/Kigali", "day_first": true},
    "url_encode": false,
    "output": "02-12-2014 09:00 28-11-2014 09:00",
    "errors": []
  },
  { /* date constructor +/- integer */
    "template": "@(DATE(2014, 7, 1) + 1) @(DATE(2014, 7, 1) - 3)",
    "context": {"vars": {}, "tz": "Africa/Kigali", "day_first": true},
    "url_encode": false,
    "output": "02-07-2014 28-06-2014",
    "errors": []
  },
  { /* datetime var +/- time */
    "template": "@(joined + TIME(2, 30, 0)) @(joined - TIME(2, 30, 0))",
    "context": {"vars": { "joined": "01-12-2014 09:00" }, "tz": "Africa/Kigali", "day_first": true},
    "url_encode": false,
    "output": "01-12-2014 11:30 01-12-2014 06:30",
    "errors": []
  },
  { /* date var +/- time */
    "template": "@(joined + TIME(2, 30, 0)) @(joined - TIME(2, 30, 0))",
    "context": {"vars": { "joined": "01-12-2014" }, "tz": "Africa/Kigali", "day_first": true},
    "url_encode": false,
    "output": "01-12-2014 02:30 30-11-2014 21:30",
    "errors": []
  },

  /* logical */

  {
    "template": "@(TRUE = TRUE) @(7 = 7) @(3.2 = 3.2) @(3.0 = 3) @(\"3\" = 3) @(\"3.0\" = 3.00) @(\"ab\" = \"ab\") @(d1 = d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:02" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE",
    "errors": []
  },
  {
    "template": "@(TRUE = FALSE) @(7 = 8) @(3.2 = 2.6) @(\"3.0\" = \"3.00\") @(\"ab\" = \"cd\") @(d1 = d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:03" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "FALSE FALSE FALSE FALSE FALSE FALSE",
    "errors": []
  },
  {
    "template": "@(TRUE <> FALSE) @(7 <> 8) @(3.2 <> 2.6) @(\"3.0\" <> \"3.00\") @(\"ab\" <> \"cd\") @(d1 <> d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:03" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "TRUE TRUE TRUE TRUE TRUE TRUE",
    "errors": []
  },
  {
    "template": "@(TRUE <> TRUE) @(7 <> 7) @(3.2 <> 3.2) @(3.0 <> 3) @(\"3\" <> 3) @(\"3.0\" <> 3.00) @(\"ab\" <> \"AB\") @(d1 <> d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:02" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE",
    "errors": []
  },
  {
    "template": "@(FALSE <= TRUE) @(TRUE <= TRUE) @(7 <= 7) @(7 <= 8) @(3.2 <= 3.2) @(3.0 <= 3) @(\"3\" <= 3) @(\"3.0\" <= 3.00) @(\"ab\" <= \"ab\") @(d1 <= d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:03" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE",
    "errors": []
  },
  {
    "template": "@(TRUE <= FALSE) @(8 <= 7) @(3.3 <= 3.2) @(3.2 <= 3) @(\"4\" <= 3) @(\"3.2\" <= 3.00) @(\"ac\" <= \"ab\") @(d2 <= d1)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:03" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE",
    "errors": []
  },
  {
    "template": "@(FALSE < TRUE) @(7 < 8) @(2.8 < 3) @(\"2.0\" < 3.00) @(\"ab\" < \"ac\") @(d1 < d2)",
    "context": {"vars": { "d1": "14-08-2015 15:02", "d2": "14-08-2015 15:03" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "TRUE TRUE TRUE TRUE TRUE TRUE",
    "errors": []
  },

  /* functions (A-Z) */

  {
    "template": "@(CHAR(9))@(CHAR(10))@(CHAR(32))@(char(65))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "\t\n A",
    "errors": []
  },
  {
    "template": "@(CLEAN(\"Hello \nwo\tr\rld\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "Hello world",
    "errors": []
  },
  {
    "template": "@(CODE(\"\t\")) @(CODE(\"\n\")) @(CODE(\"\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "9 10 @(CODE(\"\"))",
    "errors": ["Error calling function CODE with arguments \"\""]
  },
  {
    "template": "@(CONCATENATE(\"A\", 1, TRUE))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "A1TRUE",
    "errors": []
  },
  {
    "template": "@(DATE(1900, 1, 1)) @(DATE(2012, \"3\", 2.0))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "01-01-1900 02-03-2012",
    "errors": []
  },
  {
    "template": "@(DATEVALUE(\"1/2/34\")) @(DATEVALUE(\"1-2-34\")) @(DATEVALUE(\"01 02 34\")) @(DATEVALUE(\"1 Feb 34\")) @(DATEVALUE(\"1. 2 '34\")) @(DATEVALUE(\"1st february 2034\")) @(DATEVALUE(\"1er février 2034\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "01-02-2034 01-02-2034 01-02-2034 01-02-2034 01-02-2034 01-02-2034 01-02-2034",
    "errors": []
  },
  { /* dayFirst should be ignored when it doesn't make sense */
    "template": "@(DATEVALUE(\"2/25-70\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "25-02-1970",
    "errors": []
  },
  { /* year can be omitted */
    "template": "@(DATEVALUE(\"1 feb\")) @(DATEVALUE(\"Feb 1st\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "01-02-2015 01-02-2015",
    "errors": []
  },

  /* TODO add the rest of the functions */

  {
    "template": "@(FIXED(1234.5678, 1)) @(FIXED(1234.5678, 2)) @(FIXED(1234.5678, 0)) @(FIXED(1234.5678, -1)) @(FIXED(1234.5678, -4)) @(FIXED(1234.1234, 2)) @(FIXED(1234.5678, 3, TRUE))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "1,234.6 1,234.57 1,235 1,230 0 1,234.12 1234.568",
    "errors": []
  },
  {
    "template": "@(LEFT(\"abcdef\", 0))|@(LEFT(\"abcdef\", 2))|@(LEFT(\"واحد\", 2))|@(LEFT(\"err\", -1))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "|ab|وا|@(LEFT(\"err\", -1))",
    "errors": ["Error calling function LEFT with arguments \"err\", -1"]
  },
  {
    "template": "@(LEN(\"\")) @(LEN(\" \")) @(LEN(\"qwérty\")) @(LEN(\"سلام\")) @(LEN(12345))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "0 1 6 4 5",
    "errors": []
  },
  {
    "template": "@(LOWER(\"\"))|@(LOWER(\"aBcD\"))|@(LOWER(\"Aواحد\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "|abcd|aواحد",
    "errors": []
  },
  {
    "template": "@(PROPER(\"\"))|@(PROPER(\"f1rst  sécOND-third_fourth\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "|F1Rst  Sécond-Third_Fourth",
    "errors": []
  },
  {
    "template": "@(REPT(\"abc\", 3))|@(REPT(\"واحد\", 2))|@(REPT(\"err\", -1))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "abcabcabc|واحدواحد|@(REPT(\"err\", -1))",
    "errors": ["Error calling function REPT with arguments \"err\", -1"]
  },
  {
    "template": "@(RIGHT(\"abcdef\", 0))|@(RIGHT(\"abcdef\", 2))|@(RIGHT(\"واحد\", 2))|@(RIGHT(\"err\", -1))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "|ef|حد|@(RIGHT(\"err\", -1))",
    "errors": ["Error calling function RIGHT with arguments \"err\", -1"]
  },
  {
    "template": "@(SUBSTITUTE(\"ab Ab cd\", \"ab\", \"xy\", -1))|@(SUBSTITUTE(\"ab ab cd\", \"ab\", \"xy\", -1))|@(SUBSTITUTE(\"ab ab cd\", \"ab\", \"xy\", 2))|@(SUBSTITUTE(\"واحد اثنين ثلاثة\", \"واحد\", \"ثلاثة\", -1))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "xy Ab cd|xy xy cd|ab xy cd|ثلاثة اثنين ثلاثة",
    "errors": []
  },
  {
    "template": "@(UNICHAR(9))@(UNICHAR(10))@(UNICHAR(32))@(UNICHAR(65))@(UNICHAR(1575))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "\t\n Aا",
    "errors": []
  },
  {
    "template": "@(UNICODE(\"\t\")) @(UNICODE(\"\n\")) @(UNICODE(\"ا\")) @(UNICODE(\"\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "9 10 1575 @(UNICODE(\"\"))",
    "errors": ["Error calling function UNICODE with arguments \"\""]
  },
  {
    "template": "@(UPPER(\"\"))|@(UPPER(\"aBcD\"))|@(UPPER(\"Aواحد\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "|ABCD|Aواحد",
    "errors": []
  },
  {
    "template": "@(WEEKDAY(d1)) @(WEEKDAY(d2))",
    "context": {"vars": { "d1": "15-08-2015", "d2": "16-08-2015 13:45" }, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "7 1",
    "errors": []
  },

  /* syntax errors */

  { /* unbalanced parenthesis */
    "template": "@(5 + (1 + )",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(5 + (1 + )",
    "errors": []
  },
  { /* unterminated string literal */
    "template": "@(\")",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(\")",
    "errors": []
  },

  /* evaluation errors */

  { /* unsupported old single function syntax */
    "template": "@SUM(1, 2)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@SUM(1, 2)",
    "errors": ["No item called SUM in context"]
  },
  {
    "template": "@(LEN())",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(LEN())",
    "errors": ["Too few arguments provided for function LEN"]
  },
  {
    "template": "@(LEN(\"a\", \"b\"))",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(LEN(\"a\", \"b\"))",
    "errors": ["Too many arguments provided for function LEN"]
  },
  {
    "template": "@(0 / )",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(0 / )",
    "errors": ["Expression is invalid"]
  },
  {
    "template": "@(1.1.0)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(1.1.0)",
    "errors": ["Expression is invalid"]
  },
  {
    "template": "@X",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@X",
    "errors": ["No item called X in context"]
  },
  {
    "template": "@(2/ 0)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(2/ 0)",
    "errors": ["Division by zero"]
  },
  {
    "template": "@(0 /0)",
    "context": {"vars": {}, "tz": "UTC", "day_first": true},
    "url_encode": false,
    "output": "@(0 /0)",
    "errors": ["Division by zero"]
  }
]